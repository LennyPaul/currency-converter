<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>JS asynchrone</title>
  </head>
  <body>
    <form>
      <input type="number" id="baguettes" />
      <button type="submit">Allez chercher le pain</button>
    </form>
    <script>
      const form = document.querySelector("form");
      let baguetteStock = 11;

      const buyBread = (n) => {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            if (n > baguetteStock) {
              reject(
                new Error(
                  `Le boulanger n'as plus assez de pain, il ne lui reste que ${baguetteStock}`
                )
              );
            } else {
              baguetteStock -= n;
              resolve(`J'ai achetÃ© ${n} baguette${n > 1 ? "s" : ""}`);
            }
          }, 1000);
        });
      };

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const baguettes = form.baguettes.value;
        console.log("je vais achter du pain");
        console.log("Je fais la queue a la boulangerie");

        try {
          const message = await buyBread(baguettes);
          console.log(message);
        } catch (error) {
          console.error(error);
        } finally {
          setTimeout(() => console.log("Je rentre chez moi"), 2000);
        }
      });
    </script>
  </body>
</html>
